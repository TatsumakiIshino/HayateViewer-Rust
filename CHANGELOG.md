# 改訂履歴 (Changelog)

## [0.6.1-test] - 2025-12-26

### 追加

- **HOME/ENDキーによるページ移動機能の実装**
  - HOME キーで最初のページ、END キーで最後のページへ即座に移動できる機能を追加。
  - 見開き表示時も適切に位置を調整するように対応。

## [0.5.6-test] - 2025-12-25

### 追加

- **設定画面での矢印キーによる双方向の項目変更を実装**
  - 項目の選択中、右矢印キー（またはスペース・エンター・クリック）で次の項目へ、左矢印キーで前の項目へ戻れるように変更。
  - 表示モード、レンダリング方式、リサンプリング設定、ルーペ倍率、履歴件数など、すべての選択項目で双方向操作に対応。

### 変更

- **GitHub Actions タグトリガーの柔軟化**
  - リリースワークフローのタグトリガーを `vX.Y.0` から `vX.Y.Z` (任意の数字) に変更し、より柔軟なリリースに対応。

### 削除

- **ページめくりアニメーション機能の完全削除**
  - アプリケーション全体の安定性と軽量化のため、試験的に導入していたページめくりアニメーション（スライド・カール）に関連するすべてのコードと設定を削除。
  - `src/config.rs`, `src/state.rs`, `src/render/` Backends, `src/ui/modern_settings.rs` 等からアニメーション固有のロジックを一掃。
  - 専用シェーダー `page_curl.hlsl` を削除。

### 変更

- **D3D11レンダラーのリファクタリング**
  - Direct2D 依存処理を完全に排除し、純粋な Direct3D 11 パイプラインへ移行
  - テキスト描画を GDI ベースのテクスチャ生成方式に変更
  - ページカール演出のシェーダーリソース対応を強化

## [0.5.4-test] - 2024-12-24

### 追加

- **履歴ナビゲーション機能の実装**
  - PageUp キーで履歴の前（より新しい）のファイルに移動
  - PageDown キーで履歴の次（より古い）のファイルに移動
  - 履歴の端に達した場合、ステータスバーに「これ以上新しい/古い履歴はありません」と一時表示
  - 現在の履歴位置を「履歴: X/Y」形式でステータスバーに表示
- **ステータスバー一時メッセージ機能**
  - 2秒間の一時メッセージ表示機能を追加
  - 履歴ナビゲーション等のフィードバックに使用
- **履歴件数設定機能の完全実装**
  - オプション画面（全般タブ）から履歴の最大保存数を 10〜50 件の間で設定可能
  - マウスクリックおよびキーボード操作の両方に対応

### 修正

- 履歴からファイルを開いた際に履歴の順序が変わってしまう問題を修正
  - `load_new_source` に `skip_history_update` パラメータを追加し、履歴ナビゲーション時は履歴への再追加をスキップ

## [0.5.3-test] - 2024-12-24

### 追加

- **閲覧履歴機能の強化**
  - 'R' キーで履歴ウィンドウを表示（最近開いたファイルやフォルダ一覧）
  - ダブルクリックで履歴項目を開く
  - DEL キーで個別の履歴項目を削除
  - 'Shift + R' キーで履歴をクリア（確認ダイアログ付き）
  - 履歴にページ番号と綴じ方向を保存・復元
  - 履歴表示形式: `(ページ / 綴じ方向) パス`（例: `( 12 / R) D:\Books\...`）
  - アプリ終了時・ファイル切り替え時に自動保存

### 修正

- ステータスバーのパス表示が途中で切れる問題を修正
- 履歴ウィンドウのテキストが自然にウィンドウ端でクリップされるように改善
- 履歴ウィンドウの最小サイズを設定し、ヘッダーが改行しないように修正

## [0.5.2-test] - 2025-12-23

### 追加

- **フォルダ選択・書庫ファイル選択機能の実装**
  - 'F' キーでフォルダ選択ダイアログを表示。
  - 'Shift + F' キーでファイル選択ダイアログ（書庫ファイル対象）を表示。

## [0.5.1-test] - 2025-12-23

### 追加

- **ルーペ倍率変更機能の実装**
  - オプション画面（Modern UI）にてルーペの倍率（2.0x〜5.0x）を設定可能に変更。
- **開発者向け API リストの作成**
  - `src/API_LIST.md` を作成し、主要な構造体やトレイト、イベントの役割をドキュメント化。

## [0.5.0] - 2025-12-23

### 追加

- **Modern UI 設定画面のデザイン刷新**
  - フォントを `Yu Gothic UI` に変更し、視認性と美観を大幅に向上。
  - タブやフォーカスインジケータに角丸（Rounded Rectangle）を適用し、より現代的で洗練されたデザインに変更。
  - タブ名を中央揃えにし、レイアウトを最適化。
  - キーボードによる左右矢印キーでのタブ切り替えと操作のサポートを追加。
- **「情報」タブの改善**
  - アプリケーション名を大きなロゴテキストで表示し、視覚的なインパクトを強化。
  - バージョン情報、説明文、開発者クレジットを整理し、プロフェッショナルな外観に刷新。
  - 下部にコピーライト表示のフッターを追加。

### 修正

- **内部コードのクリーンアップ**
  - `modern_settings.rs` における冗長な `unsafe` ブロックの削除。
  - ビルド時の警告ゼロを達成。

## [0.4.8-test] - 2025-12-23

### 修正

- **OpenGL レンダリングにおけるページジャンプUIの不具合解消**
  - 背景描画処理を修正し、枠線が正しく描画されるように変更（塗りつぶしによる視認性低下を解決）。
  - GDI連携によるテキスト描画処理を実装し、ページ番号や入力文字が表示されない問題を修正。
  - sRGB変換を無効化し、Direct2D版と色味（背景の明るさ）を統一。
- **シークバー操作の改善**
  - ステータスバー表示時の入力判定位置を修正し、正しくドラッグ操作ができるように対応。

## [0.4.6-test] - 2025-12-22

### 修正

- **Modern UI オプション画面の細かな修正**

### 追加

- **GPUリサンプリング設定の統合と洗練**
  - `resampling_mode_gl` と `resampling_mode_dx` を廃止し、バックエンド共通の `resampling_mode_gpu` に一本化。
  - 表示名称を専門用語（Nearest Neighbor, Bilinear, Bicubic, Lanczos3）を併記したプロフェッショナルな表記に更新。
  - UI上で推奨設定（CPU: Nearest [推奨] / GPU: Lanczos3 [最高品質]）を明示。
  - レンダリングエンジン（Direct2D, D3D11, OpenGL）すべてに新しいサンプリングモードを反映。
  - D3D11 (YCbCrシェーダー描画) において、選択したサンプリングモードが反映されない問題を修正。
- **Modern UI のユーザビリティ向上**
  - 「表示モード」をボタン一つで「単一ページ」「左綴じ見開き」「右綴じ見開き」へと循環するように統合。
  - 設定項目の配置を整理（「先頭単一表示」を全般タブへ、「CPU色変換」をレンダリングタブへ移動）。
- **ドキュメントとメンテナンス**
  - `README.md` を最新の機能構成に合わせて大幅に刷新。
  - すべてのビルド警告（未使用コード、未処理のResult等）を解消し、コードクオリティを向上。
  - `Cargo.toml` のバージョンを 0.4.6-test に更新。

## [0.4.5-test] - 2025-12-22

### 追加

- **Modern UI 設定画面の機能拡充と操作性向上**
  - 各設定項目の表示を日本語に統一し、詳細な説明テキストを追加。
  - CPU色空間変換、リサンプルモード、ステータスバー表示、1ページ目単一表示など、ほぼすべての主要設定を Modern UI から操作可能に改善。
- **キーボードナビゲーションの完全対応**
  - 矢印キーによる項目移動、Enter/Space キーによる値の切り替えに対応。
  - マウス操作とキーボード操作のフォーカス管理を統合し、シームレスな操作感を実現。
- **設定状態の可視化**
  - 現在選択されているレンダリングバックエンドや設定値を視覚的に分かりやすく表示。

## [0.4.4-test] - 2025-12-22

### 追加

- **Modern UI 設定画面の基盤実装 (Direct2D)**
  - `winit` を使用した独立した設定ウィンドウの構築。
  - Direct2D によるモダンなレンダリングとマウスインタラクション（ホバー・クリック）への対応。
  - タブ切り替え（General / Rendering / About）の導入。
- **キーバインドの刷新**
  - 'O' キーで Modern UI 設定画面を、'Shift + O' キーで従来のネイティブダイアログを起動。

### 修正

- **タイトルバーのバージョン表示不備の修正**
  - バージョン情報が起動時および表示切り替え時に正しく表示されるように改善。

## [0.4.3] - 2025-12-22

### 追加

- **Windows ネイティブ設定ダイアログの導入**
  - レンダラーに依存しない GDI ベースの標準ダイアログを実装。
  - レンダリングバックエンドの変更、見開き表示、綴じ方向、リサンプルモード等の設定を統合。
- **ダイアログ表示の安定化 (デバウンス処理)**
  - 短時間の連打による多重起動と、それに伴うフリーズを防止。

### 修正

- **設定変更時の再起動プロセスの改善**
  - `winit` の終了シーケンス (`elwt.exit()`) を正規に踏むように変更し、再起動時のフリーズを解消。
- **実行時クラッシュの修正**
  - ダイアログテンプレートのフラグ不整合によるクラッシュを修正。
- **コンソールログのノイズ削減**
  - 先読み処理やレンダラー内の不要なデバッグ出力を抑制。
- **ビルド警告の解消**
  - 最新の `windows` クレート仕様に伴う型不整合や、`unsafe` ブロック、未使用変数の整理。

## [0.4.2] - 2025-12-22

### 修正

- **GPU キャッシュ（VRAM）先読み機能の不具合修正**
  - 描画ループにおいて表示中以外のページが VRAM にアップロードされない問題を修正。
  - 設定された `gpu_max_prefetch_pages` の範囲に基づき、現在ページの前後を適切にプリフェッチするように改善。
  - VRAM の解放ロジックを先読み範囲と整合性が取れるように調整し、高速スクロール時のレスポンスを向上。

## [0.4.0] - 2025-12-22

### 追加

- **OpenGL レンダラーの実装**
  - `glow` クレートを使用したモダンな OpenGL 3.3+ バックエンドを追加。
  - 浮動小数点テクスチャ (`R32F`) を使用した高精度な描画に対応。
- **Direct3D11 レンダラーの実装**
  - Direct2D に依存しない、より低レイヤーな描画パスを追加。
- **レンダラー抽象化基盤の導入**
  - `Renderer` トレイトにより、Direct2D / D3D11 / OpenGL を動的に切り替え可能に。
  - 設定画面（Options）からレンダリングエンジンを選択可能（要再起動）。
- **JPEG2000 色再現の抜本的修正**
  - 符号付きデータに対する DC レベルシフト補正（Yコンポーネントの +0.5 オフセット）を実装。
  - ICT (Irreversible Color Transform) 行列の適用による正確な色空間変換。
- **CPU 色空間変換オプションの追加**
  - GPU シェーダーではなく CPU 側で RGB 変換を行う fallback モードを追加。
- **OpenJPEG (jpeg2k クレート) への完全移行**
  - デコード性能の向上と、サブサンプリング情報の正確な処理を実現。

## [0.3.1-test] - 2025-12-21

### 追加

- **JPEG2000 高速化・高画質化の基盤導入**
  - GPU での色変換 (YCbCr -> RGB) を見据えたデータ構造の拡張。
  - `PixelData` enum の導入により、16bit/YCbCr データを維持したままキャッシュ・転送が可能に。
  - マルチデコーダ化への布石（`OpenJPEG` 導入準備）。

## [0.3.0] - 2025-12-21

### 追加

- **7z/RAR メモリ一括展開 (Slurping) 方式の導入**
  - 書庫内の全画像を初回アクセス時にメモリへ一括ロードする方式を採用。ソリッドアーカイブでのチェックサムエラーを根本解決し、2ページ目以降の表示を高速化。
- **マルチスレッド設定の追加**
  - コマンドライン引数 `--threads <NUM>` による CPU スレッド数の指定。
  - 設定メニュー（Options）への「デコードスレッド数」項目の追加。
- **アプリ終了プロセスの改善**
  - 巨大アーカイブの展開・デコード中であっても、ウィンドウを閉じれば即座にプロセスを終了するように改善。
  - 重い処理を `spawn_blocking` に隔離し、UI と終了処理の応答性を向上。

### 修正

- **7z ライブラリのリグレッション修正**
  - `sevenz-rust` 0.6.1 に戻すことで、一部の 7z ファイルが読み込めなくなっていた問題を修正。
- JPEG 2000 (JP2) デコード後のピクセル変換 (`rayon`) の最適化。

## [0.2.7-test] - 2025-12-21

4:
5: ### [0.2.7-test] 追加・改善
6:
7: - **ズーム機能の強化**:
8:   - **Ctrl + マウスホイール**: マウスカーソル位置を中心に拡大・縮小が可能に。
9:   - **キーボードショートカット**: テンキーの `+` / `-` および通常キーの `+` / `-` によるズームに対応。
10:   - **ズームリセット**: テンキーの `*` キーでズームレベルを 1.0 にリセット。
11:

## [0.2.6] - 2025-12-21

### [0.2.6] 追加・改善

- **RAR (CBR) 書庫のサポート**:
  - `unrar` クレートの導入により、現代的な RAR5 形式に完全対応。
  - **遅延展開（Lazy Extraction）方式**を採用。書庫オープン時の UI フリーズを解消し、バックグラウンドでの安定した画像読み込みを実現。
  - 7z 形式についても同様に遅延展開化し、全体的なレスポンス性能を向上。
  - 隣接ボリューム移動機能（`[` / `]` キー）における RAR ファイルのネイティブ認識。

## [0.2.5] - 2025-12-21

### [0.2.5] 追加・改善

- **キャッシュ・メモリ管理の抜本的最適化**:
  - CPUキャッシュを単なる LRU から「現在ページからの距離」を考慮した管理方式に変更。
  - 表示中のページをキャッシュから絶対に破棄しない保護機能を追加し、高速スクロール時の画面チラつき（暗転）を解消。
- **読み込み優先度制御 (AsyncLoader) の導入**:
  - 先読みリクエストに優先度（Priority）を導入し、「現在表示されているページ」を最優先でロードするようキューを再編。
  - 古くなった非効率な読み込みリクエストを自動的にスキップし、描画のレスポンス性能を向上。
- **Loading インジケータの追加**:
  - 画像の読み込みが間に合わない場合に `Loading Page X...` と表示。
  - 画像未ロードの状態でも適切なレイアウト枠を維持し、描画ガタつきを防止。
- **ビルド環境のクリーンアップ**:
  - 未使用の変数、インポート、デッドコードを整理・抑制し、警告のないクリーンなビルドを実現。
  - 非同期処理のスレッド安全性 (Send境界) を改善し、実行時の安定性を向上。

### [0.2.5] 修正

- 見開き表示において、一部のページが正しくキャッシュされず表示されない問題を修正。
- 高速スクロール時に GPU メモリ解放とロードが競合して描画が不安定になる現象を解消。

## [0.2.4] - 2025-12-21

### [0.2.4] 追加・改善

- **フォルダ/アーカイブ間移動機能の追加**:
  - `[` キー（前へ）と `]` キー（次へ）で、同じディレクトリ内の次のフォルダやアーカイブ（ZIP, 7z, CBZ）に直接移動できる機能を追加。
  - 自然順ソート（natord）に基づいた適切な順序での遷移を実現。
- **CBZ形式のサポート**:
  - アーカイブ読み込み対象に `.cbz` 拡張子を追加。

## [0.2.3] - 2025-12-21

### [0.2.3] 追加・改善

- **シークバーのインタラクティブ化**:
  - マウスのクリック・ドラッグによる直感的なページ移動に対応。
  - 操作中のバーの強調表示（太さ・色の変化）による視覚的フィードバック。
  - 見開き表示時のスナップ機能（表紙やフォルダ境界を考慮した適切な位置への制御）。
- **ページジャンプUI (Shift+S) のリデザイン**:
  - 入力画面の刷新（角丸パネル、統合された中央揃えレイアウト）。
  - 点滅カーソルの導入と大型フォント（24pt/Bold）による視認性の向上。
  - 論理キー判定への切り替えによる数値入力（テンキー含む）の確実な動作。
- **ステータス表示の改善**:
  - 見開き表示時に「2-3 / 204」のように表示中のページ範囲を示す形式に変更。
- **描画エンジンの拡張**:
  - レンダラーに角丸矩形、テキスト中央揃え、大型フォント用フォーマットなどの機能を追加。

## [0.2.2] - 2025-12-21

- **設定画面（オーバーレイ）の日本語実装**:
  - アプリ内で操作可能な設定画面を Direct2D で構築。
  - レンダリングエンジン、見開き、綴じ方向、補間モード、キャッシュ容量などを日本語で設定可能。
- **設定の動的反映**:
  - 設定変更後、即座に描画（リサンプリング精度やステータスバーの表示切替など）に反映。
- **コンソール表示の抑制**:
  - リリースビルド版において、不要なコンソールウィンドウが表示されないよう属性を設定。
- **プロジェクト情報の整理**:
  - 日本語による `README.md` の作成。
  - バージョン情報をウィンドウタイトルに表示し、ソースコード内で一括管理。

### [0.2.2] 修正

- **ルーペ機能の正確な拡大ロジック**:
  - ウィンドウ中央を基準とした正しい相対パン計算式を導入し、クリックした位置がズーム後もずれないように修正。
  - 見開き表示時に、拡大位置によってページが画面外に消えてしまう不具合を解消。
- **ビルド・CI環境の修正**:
  - Git のコミット漏れによるビルドエラーを修正し、GitHub Actions による自動リリースを安定化。

---

## [0.2.0] - 2025-12-21

- Rust版 HayateViewer (Direct2D) の基本機能の実装。
- ZIP, 7z 対応、見開き表示機能。
